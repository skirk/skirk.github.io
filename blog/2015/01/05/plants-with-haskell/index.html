
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Plants with Haskell - Tuomo's corner</title>
	<meta name="author" content="Tuomo Rinne">

	
	<meta name="description" content="To fill the void in my life I decided to look into new programming language. From afar haskell seemed like a funky language so off I went! As an &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Tuomo's corner" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--  -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- Load jQuery -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
	jQuery.noConflict(); // ender.js conflicts with jQuery
</script>
<!-- Load FancyBox -->
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" />
<script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
<!-- Fix FancyBox style for OctoPress -->
<style type="text/css">
  .fancybox-wrap { position: fixed !important; }
  .fancybox-opened {
    -webkit-border-radius: 4px !important;
       -moz-border-radius: 4px !important;
            border-radius: 4px !important;
  }
  .fancybox-close, .fancybox-prev span, .fancybox-next span {
    background-color: transparent !important;
    border: 0 !important;
  }
</style>

<!-- Custom Scripts -->
<script language="Javascript" type="text/javascript">
	// ender.js gobbles jQuery's ready event: Use ender.js $ instead
	$(document).ready(function() {
		jQuery(".fancybox").fancybox();
	});
</script> 

</head>

<body>
	<div class="container">	

		<div class="mid-col-container">
			<div id="content" class="inner">
				<div class="center"><a href="/"><img src="/images/loading_pacman2.gif"></a><a href="/about">&#8226 About </a><a href="/blog/archives">&#8226 Archive </a><a href="/contact">&#8226 Contact</a></div>
				<article class="post">
	<h1 class="title">Plants With Haskell</h1>
	<div class="entry-content"><p>To fill the void in my life I decided to look into new programming language. From afar haskell seemed like a funky language so off I went! As an exercise I picked up something I conceptually simple: L-systems.</p>

<p>My first take was more or less as I would have approached the problem with imperative languages. It&rsquo;s quite nice and neat to produce the lsystem string.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="c1">-- Different types of nodes</span>
</span><span class='line'><span class="kr">data</span> <span class="kt">LNode</span> <span class="ow">=</span> <span class="kt">Draw</span> <span class="o">|</span> <span class="kt">TLeft</span> <span class="o">|</span> <span class="kt">TRight</span> <span class="o">|</span> <span class="kt">Push</span> <span class="o">|</span> <span class="kt">Pop</span> <span class="o">|</span> <span class="kt">PHolder</span>
</span><span class='line'><span class="c1">-- Rules for creating new strings</span>
</span><span class='line'><span class="nf">become</span> <span class="kt">PHolder</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">Draw</span><span class="p">,</span> <span class="kt">TLeft</span> <span class="p">,</span><span class="kt">Push</span><span class="p">,</span> <span class="kt">Push</span><span class="p">,</span> <span class="kt">PHolder</span><span class="p">,</span>
</span><span class='line'>        <span class="kt">Pop</span><span class="p">,</span> <span class="kt">TRight</span><span class="p">,</span> <span class="kt">PHolder</span><span class="p">,</span> <span class="kt">Pop</span><span class="p">,</span> <span class="kt">TRight</span><span class="p">,</span>
</span><span class='line'>        <span class="kt">Draw</span><span class="p">,</span> <span class="kt">Push</span><span class="p">,</span> <span class="kt">TRight</span><span class="p">,</span> <span class="kt">Draw</span><span class="p">,</span> <span class="kt">PHolder</span><span class="p">,</span>
</span><span class='line'>                  <span class="kt">Pop</span><span class="p">,</span> <span class="kt">TLeft</span><span class="p">,</span><span class="kt">PHolder</span><span class="p">]</span>
</span><span class='line'><span class="nf">become</span> <span class="kt">Draw</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">Draw</span><span class="p">,</span> <span class="kt">Draw</span><span class="p">]</span>
</span><span class='line'><span class="nf">become</span> <span class="n">n</span> <span class="ow">=</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nf">recurse</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">LNode</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">LNode</span><span class="p">]</span>
</span><span class='line'><span class="nf">recurse</span> <span class="n">ns</span> <span class="n">i</span>
</span><span class='line'>  <span class="o">|</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">=</span> <span class="n">recurse</span> <span class="p">(</span><span class="n">concatMap</span> <span class="n">become</span> <span class="n">ns</span><span class="p">)</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">ns</span>
</span></code></pre></td></tr></table></div></figure>


<p>To draw the tree:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">foreach</span> <span class="p">(</span><span class="n">recurse</span> <span class="p">[</span><span class="kt">PHolder</span><span class="p">]</span> <span class="mi">6</span><span class="p">)</span> <span class="o">$</span> <span class="nf">\</span> <span class="n">x</span> <span class="ow">-&gt;</span>
</span><span class='line'>  <span class="kr">do</span> <span class="n">drawNode</span> <span class="n">x</span>
</span><span class='line'>
</span><span class='line'><span class="c1">-- Drawing function for each node</span>
</span><span class='line'><span class="nf">drawNode</span> <span class="kt">Draw</span>  <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>    <span class="kt">C</span><span class="o">.</span><span class="n">rectangle</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.06</span><span class="p">)</span> <span class="mi">0</span> <span class="mf">0.12</span> <span class="mf">0.25</span>
</span><span class='line'>      <span class="kt">C</span><span class="o">.</span><span class="n">translate</span> <span class="mi">0</span> <span class="mf">0.25</span>
</span><span class='line'><span class="nf">drawNode</span> <span class="kt">TLeft</span>  <span class="ow">=</span> <span class="kt">C</span><span class="o">.</span><span class="n">transform</span> <span class="o">$</span>  <span class="n">rotate2d</span> <span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="nf">drawNode</span> <span class="kt">TRight</span>  <span class="ow">=</span> <span class="kt">C</span><span class="o">.</span><span class="n">transform</span> <span class="o">$</span> <span class="n">rotate2d</span>  <span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="nf">drawNode</span> <span class="kt">Pop</span> <span class="ow">=</span>  <span class="kt">C</span><span class="o">.</span><span class="n">restore</span>
</span><span class='line'><span class="nf">drawNode</span> <span class="kt">Push</span> <span class="ow">=</span>  <span class="kt">C</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'><span class="nf">drawNode</span> <span class="kt">PHolder</span> <span class="ow">=</span> <span class="kt">C</span><span class="o">.</span><span class="n">rectangle</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>A result of this:
<a href="/images/post/basicbush.jpg" class="fancybox" title=""><img src="/images/post/thumb/basicbushthumb.jpg" alt="" /></a></p>

<p>Even though the code is fairly neat, the code bugged me because it looked almost like C code. That&rsquo;s not acceptable! This is functional programming afterall. In the next approach I did a bit research and found an <a href="http://fhtr.blogspot.fi/2008/12/drawing-tree-with-haskell-and-cairo.html">article</a> (Man, that dude has pretty code, check it out!) that had something I wanted to do. So I took creative license and modified some of the stuff to create an tDOL-system <a href="#botanic">(Prusinkiewicz &#38; Lindenmayer, 1996)</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">trunk</span> <span class="n">n</span> <span class="n">angle</span>
</span><span class='line'>      <span class="o">|</span>  <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="ow">=</span> <span class="kt">[]</span>
</span><span class='line'>      <span class="o">|</span>  <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">=</span> <span class="p">[(</span><span class="n">wtgf</span> <span class="n">n</span><span class="p">,</span> <span class="n">map</span> <span class="p">(</span><span class="n">rotateP</span> <span class="n">angle</span><span class="p">)</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tgf</span> <span class="n">n</span><span class="p">)])]</span>
</span><span class='line'>      <span class="o">|</span>  <span class="n">otherwise</span>  <span class="ow">=</span> <span class="p">(</span><span class="n">thickness</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span> <span class="kt">:</span> <span class="n">evolve</span>
</span><span class='line'>          <span class="kr">where</span>
</span><span class='line'>              <span class="n">points</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="n">rotateP</span> <span class="n">angle</span><span class="p">)</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">igf</span> <span class="n">n</span><span class="p">)]</span>
</span><span class='line'>              <span class="n">thickness</span> <span class="ow">=</span> <span class="n">wigf</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>              <span class="p">[</span><span class="kr">_</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)]</span> <span class="ow">=</span> <span class="n">points</span>
</span><span class='line'>              <span class="n">evolve</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="n">mapWidthLine</span> <span class="p">(</span><span class="n">translateP</span> <span class="n">x</span> <span class="n">y</span><span class="p">))</span> <span class="p">(</span><span class="n">left</span> <span class="o">++</span> <span class="n">right</span> <span class="o">++</span> <span class="n">apex</span><span class="p">)</span>
</span><span class='line'>              <span class="n">left</span>  <span class="ow">=</span> <span class="n">branch</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>              <span class="n">right</span> <span class="ow">=</span> <span class="n">branch</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">angle</span> <span class="o">+</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>              <span class="n">apex</span>  <span class="ow">=</span> <span class="n">trunk</span>  <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">angle</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">branch</span> <span class="n">n</span> <span class="n">angle</span>
</span><span class='line'>      <span class="o">|</span>  <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="ow">=</span> <span class="kt">[]</span>
</span><span class='line'>      <span class="o">|</span>  <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">aa</span>  <span class="ow">=</span> <span class="p">[(</span><span class="n">wbgf</span> <span class="n">n</span><span class="p">,</span> <span class="n">map</span> <span class="p">(</span><span class="n">rotateP</span> <span class="n">angle</span><span class="p">)</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bgf</span> <span class="n">n</span><span class="p">)])]</span>
</span><span class='line'>          <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span>  <span class="n">trunk</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">aa</span><span class="p">)</span> <span class="n">angle</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s the result of the animated simulation of a um.. tree?
<img src="/images/post/opttree.gif"></p>

<h2>References</h2>

<ol class="bibliography"><li><span id="botanic">Prusinkiewicz, P., &#38; Lindenmayer, A. (1996). <i>The Algorithmic Beauty of Plants</i>. New York, NY, USA: Inc. Springer-Verlag New York.</span></li></ol>

</div>

</article>


			</div>
		</div>
		<footer id="footer" class="inner">
		Copyright &copy; 2015 

    <a href="/about">Tuomo Rinne</a>
 |
<span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, customized with <a href="https://github.com/mjhea0/nologo">noLogo</a> + my own hacks</span>
</footer>
		<script src="/javascripts/slash.js"></script>








	</div>
</body>
</html>
